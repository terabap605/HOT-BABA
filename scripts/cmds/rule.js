// file: rules.js
const axios = require("axios");
const fs = require("fs-extra");
const path = require("path");

module.exports = {
  config: {
    name: "rule",
    version: "1.1",
    author: "Cyclopean c. Blade",
    role: 0,
    shortDescription: "Show GC rules in stylish format",
    longDescription: "Display Mini Studio group rules in stylish Bangla format with attached video",
    category: "group",
    guide: "{pn}rules"
  },

  // Prefix ржжрж┐ржпрж╝рзЗ рж░рж╛ржи рж╣ржмрзЗ
  onStart: async function ({ message }) {
    await sendRules(message);
  },

  // No prefix ржжрж┐ржпрж╝рзЗ рж░рж╛ржи рж╣ржмрзЗ
  onChat: async function ({ event, message }) {
    const body = (event.body || "").toLowerCase().trim();
    const triggers = ["rule", "rules", "gc rules"];
    if (!triggers.includes(body)) return;
    await sendRules(message);
  }
};

// ---- Custom Rules Sender Function ----
async function sendRules(message) {
  const rulesDesign = `
тХФтХРтХРтХРтФБтФБтФБтФАтФАтФАтАвтЬзтАвтФАтФАтФАтФБтФБтФБтХРтХРтХРтХЧ
      ЁЯОмтЬи ЁЭЧаЁЭЧ╢ЁЭЧ╗ЁЭЧ╢ ЁЭЧжЁЭШБЁЭШВЁЭЧ▒ЁЭЧ╢ЁЭЧ╝ тЬиЁЯОм
     уАО V╔кс┤Ес┤Зс┤П Mс┤Ас┤Лс┤З уАП
        ЁЯУЬ ЁЭРЖЁЭРВ ЁЭРСЁЭРоЁЭРеЁЭРЮЁЭРм ЁЯУЬ
тХЪтХРтХРтХРтФБтФБтФБтФАтФАтФАтАвтЬзтАвтФАтФАтФАтФБтФБтФБтХРтХРтХРтХЭ

тШгя╕П ржПржЗ ржЧрзНрж░рзБржкржЯрж┐ рж╢рзБржзрзБржорж╛рждрзНрж░ ЁЭС╜ЁЭТКЁЭТЕЁЭТЖЁЭТР ржмрж╛ржирж╛ржирзЛрж░ ржЬржирзНржп  
ЁЯЪл ржЕржирзНржп ржХрзЛржирзЛ ржкрзНрж░ржХрж╛рж░ ржЯрзЗржХрзНрж╕ржЯ ржХрж░рж╛ ржпрж╛ржмрзЗ ржирж╛  

тСа ЁЯО╡ ЁЭРАЁЭРЭЁЭРжЁЭРвЁЭРз ржЖржкржирж╛ржжрзЗрж░ ржЧрж╛ржи ржПрж░ рж▓рж╛ржЗржи ржжрж┐ржмрзЗ  
   тд╖ ржорзЗржирж╢ржи ржХрж░рж╛ ржЖржЗржбрж┐ ржирж┐ржЬ ржжрж╛рзЯрж┐рждрзНржмрзЗ рж▓рж╛ржЗржи ржжрж┐ржмрзЗ  
   ЁЯУМ рж▓рж╛ржЗржи ржжрзЗржУрзЯрж╛рж░ ржирж┐рзЯржо:  
      тАв ржирж┐ржЬрзЗрж░ ржкржЫржирзНржжрзЗрж░ ржкрж┐ржХ ЁЯУ╖  
      тАв рждрж╛рж░ржкрж░ рж╕рзЗржЗ ржЧрж╛ржирзЗрж░ рж▓рж╛ржЗржи ЁЯО╢

тСб тШв ржЦрж╛рж░рж╛ржк ржЫржмрж┐/ржнрж┐ржбрж┐ржУ тЭМ  
   ржУ ржЦрж╛рж░рж╛ржк ржоржирзНрждржмрзНржп ЁЯЪл рж╕ржорзНржкрзВрж░рзНржг ржирж┐рж╖рж┐ржжрзНржз

тСв ЁЯТм рж▓рж╛ржЗржи ржУ ржкрж┐ржХ-ржП рж░рж┐ржЕрзНржпрж╛ржХрзНржЯ ржжрж┐рждрзЗ рж╣ржмрзЗ  
   ЁЯФД рж░рж┐ржЕрзНржпрж╛ржХрзНржЯ ржирж╛ ржжрж┐рж▓рзЗ ржЧрж╛ржи рж▓рж╛ржЗржи ржкрж╛ржмрзЗржи ржирж╛

тСг тЫФ ржПржХржЯрж┐ржн ржирж╛ ржерж╛ржХрж▓рзЗ  
   тЪб ржирж╛ ржмрж▓рзЗржЗ ржХрж┐ржХ ржХрж░рж╛ рж╣ржмрзЗ

тСд ЁЯСС ржПржбржорж┐ржиржжрзЗрж░ ржмрж┐рж░рзБржжрзНржзрзЗ ржпрж╛ржмрзЗржи ржирж╛  
   ЁЯТМ ржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ рж╣рж▓рзЗ ржПржбржорж┐ржирзЗрж░ ржЗржиржмржХрзНрж╕рзЗ ржмрж▓рзБржи

тСе ЁЯЪ╖ ржХрж╛рж░рзЛ ржкрж┐ржХ ржирж┐рзЯрзЗ ржоржЬрж╛ тЭМ  
   ЁЯЩГ рж╣рж╛ рж╣рж╛ рж░рж┐ржЕрзНржпрж╛ржХрзНржЯржУ ржжрж┐ржмрзЗржи ржирж╛

тСж ЁЯТм ржЖржбрзНржбрж╛ ржЧрзНрж░рзБржк рж▓рж╛ржЧрж▓рзЗ  
   тЩ╗я╕П ржПржбржорж┐ржиржХрзЗ ржЬрж╛ржирж╛рж▓рзЗ ржЕрзНржпрж╛ржб ржХрж░рзЗ ржжрзЗржмрзЗ

тХФтХРтХРтХРтФБтФБтФБтФАтФАтФАтАвтЬзтАвтФАтФАтФАтФБтФБтФБтХРтХРтХРтХЧ
   ЁЯТЭ ржПржЗ ржЫрж┐рж▓рзЛ ЁЭЧаЁЭЧ╢ЁЭЧ╗ЁЭЧ╢ ЁЭЧжЁЭШБЁЭШВЁЭЧ▒ЁЭЧ╢ЁЭЧ╝ ржПрж░ Rule ЁЯТЭ
тХЪтХРтХРтХРтФБтФБтФБтФАтФАтФАтАвтЬзтАвтФАтФАтФАтФБтФБтФБтХРтХРтХРтХЭ
`;

  try {
    const videoUrl = "https://drive.google.com/uc?export=download&id=1Cj_0_JE0W6O0G1K68bYt-pAmUaX1GQKV";
    const tempPath = path.join(__dirname, "rules_video.mp4");

    // ржнрж┐ржбрж┐ржУ ржбрж╛ржЙржирж▓рзЛржб
    const response = await axios.get(videoUrl, { responseType: "arraybuffer" });
    fs.writeFileSync(tempPath, Buffer.from(response.data, "utf-8"));

    // ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржирзЛ
    await message.reply({
      body: rulesDesign,
      attachment: fs.createReadStream(tempPath)
    });

    // ржЕрж╕рзНржерж╛рзЯрзА ржлрж╛ржЗрж▓ ржбрж┐рж▓рж┐ржЯ
    fs.unlinkSync(tempPath);

  } catch (err) {
    console.error(err);
    await message.reply(rulesDesign + "\n\nтЪая╕П ржнрж┐ржбрж┐ржУ рж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗред");
  }
}
